type: leaky
name: crowdsecurity/CVE-2014-6271
description: "Detect CVE-2014-6271 Shellshock exploit attempt"
filter: |
  (
    evt.Parsed.http_user_agent matches ".*\\(\\)\\s*\\{\\s*[:]?\\s*;\\s*\\}\\s*;.*" ||
    evt.Parsed.http_path matches ".*\\(\\)\\s*\\{\\s*[:]?\\s*;\\s*\\}\\s*;.*" ||
    evt.Parsed.http_referer matches ".*\\(\\)\\s*\\{\\s*[:]?\\s*;\\s*\\}\\s*;.*" ||
    evt.Parsed.http_user_agent matches ".*env\\s+[a-zA-Z_][a-zA-Z0-9_]*=[\"']?\\(\\).*" ||
    evt.Parsed.http_user_agent matches ".*(bash|sh)\\s*-c\\s*[\"'].*\\(\\).*" ||
    evt.Parsed.http_user_agent matches ".*echo\\s+[\"']?vulnerable[\"']?.*\\(\\).*"
  ) &&
  evt.Meta.source_ip != nil
leakspeed: "10s"
capacity: 1
blackhole: 1m
groupby: "evt.Meta.source_ip"
labels:
  type: exploit
  remediation: true
  classification:
    - attack.T1190
    - cve.CVE-2014-6271
  spoofable: 0
  confidence: 5
  behavior: "http:exploit"
  label: "Shellshock CVE-2014-6271"
  service: web
---
type: leaky
name: crowdsecurity/CVE-2014-6278
description: "Detect CVE-2014-6278 Bash command substitution exploit attempt"
filter: |
  (
    evt.Parsed.http_user_agent matches ".*\\$\\(.*\\{.*\\}.*\\).*" ||
    evt.Parsed.http_path matches ".*\\$\\(.*\\{.*\\}.*\\).*" ||
    evt.Parsed.http_referer matches ".*\\$\\(.*\\{.*\\}.*\\).*" ||
    evt.Parsed.http_user_agent matches ".*\\`.*\\{.*\\}.*\\`.*" ||
    evt.Parsed.http_user_agent matches ".*\\$\\{.*\\}.*\\$\\(.*\\).*" ||
    evt.Parsed.http_user_agent matches ".*function\\s+\\w+.*\\{.*\\$\\(.*\\).*\\}.*" ||
    evt.Parsed.http_user_agent matches ".*\\(\\).*\\{.*\\$\\(.*\\{.*\\}.*\\).*\\}.*"
  ) &&
  evt.Meta.source_ip != nil
leakspeed: "10s"
capacity: 1
blackhole: 1m
groupby: "evt.Meta.source_ip"
labels:
  type: exploit
  remediation: true
  classification:
    - attack.T1190
    - cve.CVE-2014-6278
  spoofable: 0
  confidence: 4
  behavior: "http:exploit"
  label: "Bash CVE-2014-6278 Command Substitution"
  service: web

---
type: leaky
name: crowdsecurity/shellshock-redirection-exploit
description: "Detect Shellshock exploit with command substitution and redirection"
filter: |
  (
    evt.Parsed.http_user_agent matches ".*\\(\\)\\s*\\{.*\\}\\s*;.*>.*\\$\\(.*\\).*" ||
    evt.Parsed.http_path matches ".*\\(\\)\\s*\\{.*\\}\\s*;.*>.*\\$\\(.*\\).*" ||
    evt.Parsed.http_referer matches ".*\\(\\)\\s*\\{.*\\}\\s*;.*>.*\\$\\(.*\\).*" ||
    evt.Parsed.http_user_agent matches ".*\\(\\)\\s*\\{.*\\}\\s*;.*\\|.*\\$\\(.*\\).*" ||
    evt.Parsed.http_user_agent matches ".*\\(\\)\\s*\\{.*\\}\\s*;.*<.*\\$\\(.*\\).*"
  ) &&
  evt.Meta.source_ip != nil
leakspeed: "5s"
capacity: 1
blackhole: 2m
groupby: "evt.Meta.source_ip"
labels:
  type: exploit
  remediation: true
  classification:
    - attack.T1190
    - attack.T1041  # Data Exfiltration
    - cve.CVE-2014-6271
  spoofable: 0
  confidence: 5
  behavior: "http:exploit"
  label: "Shellshock with Command Injection and Redirection"
  service: web
