type: trigger
name: crowdsecurity/shellshock-redirection-exploit
description: "Detect Shellshock exploit with command substitution and redirection"
filter: |
  (
    evt.Parsed.http_user_agent matches ".*\\(\\)\\s*\\{.*\\}\\s*;.*>.*\\$\\(.*\\).*" ||
    evt.Parsed.http_path matches ".*\\(\\)\\s*\\{.*\\}\\s*;.*>.*\\$\\(.*\\).*" ||
    evt.Parsed.http_referer matches ".*\\(\\)\\s*\\{.*\\}\\s*;.*>.*\\$\\(.*\\).*" ||
    evt.Parsed.http_user_agent matches ".*\\(\\)\\s*\\{.*\\}\\s*;.*\\|.*\\$\\(.*\\).*" ||
    evt.Parsed.http_user_agent matches ".*\\(\\)\\s*\\{.*\\}\\s*;.*<.*\\$\\(.*\\).*"
  ) &&
  evt.Meta.source_ip != nil
groupby: "evt.Meta.source_ip"
labels:
  type: exploit
  remediation: true
  classification:
    - attack.T1190
    - attack.T1041
    - cve.CVE-2014-6271
  spoofable: 0
  confidence: 5
  behavior: "http:exploit"
  label: "Shellshock with Command Injection and Redirection"
  service: web
